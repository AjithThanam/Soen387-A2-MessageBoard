<html>
   <head>
      <title> Message Board </title>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>  
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
      <link rel="stylesheet" href="post-edit.css">
   </head>
   <body onload="init()">
      <div class="card">
            <h2>Edit post</h2>
      <form id="mainForm" method="post" enctype="multipart/form-data">
            
            <h6> Title </h6> 
                  <input class="title" type="text" id="title" name="title"><br/><br/>
            <h6>Message </h6> 
                  <input class="message" type="text" id="mes" name="message"><br/><br/>

            <h6>Group</h6>
            <select name="group" id="groupInput"></select>

            <h6> Change Attachment </h6>
                  <input type="file" name="fileName"><br/><br/>
            <h6>Remove Attachment</h6>
                   Click to remove attachments  <input type="checkbox" name="removeAttach"><br />

            <input type="hidden" id="userId" name="userID"><br/>
            <input type="hidden" id="postId" name="postID"><br/>

            <div style="padding-left: 38.5%;"><input type="submit" value="Upload"></div>
      </form>

      <div class="centered"><a href="/home">Back</a></div>

      <script>
            function init(){

                  setURL();
                  if(localStorage.getItem('loggedIn') !== 'true'){
                        window.location.href = '/login';
                  }

                  var current_post = JSON.parse(localStorage.getItem('edit-post'));
                  document.getElementById("userId").value = localStorage.getItem('id');
                  document.getElementById("postId").value = current_post.id;
                  document.getElementById("title").value = current_post.title;
                  document.getElementById("mes").value = current_post.message;

                  loadGroups(current_post.group);
            }

            function setURL(){
                  let domain = localStorage.getItem('domain');
                  document.getElementById("mainForm").action = domain + "/MessageBoard_war_exploded/attachments";

            }

            function loadGroups(currentGroup){
                  //load group options
                  let groupOptions = JSON.parse(localStorage.getItem('groups'));
                  let groupHtml = document.getElementById('groupInput');
                  
                  //load current as first entry in dropdown
                  groupHtml.options[groupHtml.options.length] = new Option(currentGroup, currentGroup);

                  for(var i = 0; i < groupOptions.length; i++){
                        var groupName = groupOptions[i];
                        alert(groupName);
                        if(groupName == currentGroup){
                              continue;
                        }
                        groupHtml.options[groupHtml.options.length] = new Option(groupName, groupName);
                  }
            }

      </script>

      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js" integrity="sha384-LtrjvnR4Twt/qOuYxE721u19sVFLVSA4hf/rRt6PrZTmiPltdZcI7q7PXQBYTKyf" crossorigin="anonymous"></script>
   </body>
</html>